<html>
<head>
	<title>Startup Data Visualization - Angela Hu, Val Mack, Rong Wu</title>
	<link rel="stylesheet" href="main.css"/>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
</head>
<body>
	<div class="intro">
		<h1>Startups 2017</h1>
		<hr/>
	</div>
	<div class="main">
		<svg id="fig3"></svg>
	</div>
	<script>
		// globals
		var width = "95%";
		var height = "500";
		
		var backgroundColor = "#f5f5f5";
		
		// scales
		var employeesScale = d3.scaleSqrt().domain([0, 5000]).range([20, 500]);
		var companiesScale = d3.scaleLinear().domain([0, 53]).range([.2, 24]);
		
		/* BEGIN FIGURE 3 */
		
		var rawData;
		var companiesBySize;
		
		function parse(row) {
			if (row.Employees) {
				var dash = row.Employees.indexOf("-");
				row.Employees = parseFloat(row.Employees.slice(dash+1));
				return row;
			}
		}
		
		// load data
		d3.csv("100companies_employees.csv", parse, function (error, data) {
			if (error) { console.log(error); }
			
			rawData = data;
			
			companiesBySize = d3.nest()
			.key(function (d) { return d.Employees; })
			.entries(rawData);
			
			f3.selectAll("circle")
			.data(companiesBySize)
			.enter()
			.append("circle")
			.attr("cx", widthFloat/2)
			.attr("cy", height/2)
			.attr("fill", backgroundColor)
			.attr("stroke", "steelblue")
			.attr("r", function(d) {
				// employee size
				return employeesScale(d.key);
			})
			.attr("stroke-width", function(d) {
				// number of companies
				return companiesScale(d.values.length);
			})
			.on("mouseover", showEmployees)
			.on("mouseout", hideEmployees);
			
			var labels = f3.append("g")
			.attr("transform", "translate("+widthFloat/2+","+height/2+")");
			
			function showEmployees(d) {
				console.log(d.key);
				labels.append("text")
				.text(d.key)
				.attr("x", employeesScale(d.key)+companiesScale(d.values.length)
				)
				.attr("y", "0")
				.attr("z-index","99999999")
				.attr("fill", "steelblue")
				.attr("alignment-baseline","middle");
			}
			
			function hideEmployees(d) {
				labels.selectAll("text").remove();
			}
			
			
//			labels.selectAll("text")
//			.data(companiesBySize)
//			.enter()
//			.append("text")
//			.text(function(d) {
//				return d.key;
//			})
//			.attr("x", function(d) {
//				return employeesScale(d.key)+companiesScale(d.values.length);
//			})
//			.attr("y", "0")
//			.attr("fill", "steelblue")
//			.attr("alignment-baseline","middle");
			
		});
		
		var f3 = d3.select("#fig3").attr("width", width).attr("height", height);
		
		var widthFloat = parseFloat(f3.style("width"));
		
		
		
	</script>
</body>
</html>